(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2689:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>T});var i=s(5155),r=s(2115);async function o(t){await new Promise(e=>setTimeout(e,t))}var a=s(226);class n extends r.Component{async typeAsync(t){var e,s,i,r,a,n,c;for(let e of t){this.state.animating.push(e),this.setState(t=>({animating:[...t.animating]}));let t=[".","!","?"].includes(e),h=[",",";",":"].includes(e),l=this.props.typeSpeed;if(t&&(l=25*this.props.typeSpeed),h&&(l=10*this.props.typeSpeed),this.props.pitch>0){let t=e.toLowerCase();if(/[a-z0-9]/.test(t)){let o=1+(t.charCodeAt(0)%10+1)/10/5;/[aeiou]/.test(e)?null===(i=this.oscillator)||void 0===i||i.frequency.setValueAtTime(1.2*this.props.pitch*o,(null===(s=this.audioCtx)||void 0===s?void 0:s.currentTime)||0):null===(a=this.oscillator)||void 0===a||a.frequency.setValueAtTime(this.props.pitch*o,(null===(r=this.audioCtx)||void 0===r?void 0:r.currentTime)||0)}else" "!=e&&(null===(c=this.oscillator)||void 0===c||c.frequency.setValueAtTime(0,(null===(n=this.audioCtx)||void 0===n?void 0:n.currentTime)||0))}await o(l)}this.props.pitch>0&&(this.oscillator.stop(),this.audioCtx.close()),null===(e=this.props.onFinished)||void 0===e||e.call(this)}async makeStatic(){let t=this.state.animating.shift();this.setState(e=>({animating:[...e.animating],text:e.text+t}))}render(){return(0,i.jsxs)("span",{style:{whiteSpace:"pre-wrap",...this.props.blockStyle},children:[(0,i.jsx)("span",{style:{display:"inline-block"},children:this.state.text},"static-text"),this.state.animating.map((t,e)=>(0,i.jsx)(a.P.div,{onAnimationComplete:()=>this.makeStatic(),style:{display:"inline-block",...this.props.characterStyle},initial:{opacity:0,...this.props.characterInitial},animate:{opacity:1,...this.props.characterAnimate},transition:{duration:.3,ease:"easeOut",...this.props.characterTransition},children:t},this.state.text.length+e))]},"typewriter-span")}constructor(t){if(super(t),this.oscillator=null,this.audioCtx=null,this.isRunning=!1,this.state={animating:[],text:""},this.props.pitch>0){this.audioCtx=new window.AudioContext;let t=this.audioCtx.createGain();t.gain.value=this.props.gain/3,t.connect(this.audioCtx.destination),this.oscillator=this.audioCtx.createOscillator(),this.oscillator.type="triangle",this.oscillator.connect(t),this.oscillator.frequency.setValueAtTime(0,this.audioCtx.currentTime),this.oscillator.start()}this.isRunning||(this.isRunning=!0,this.typeAsync(this.props.text))}}let c={color:h,speed:p,size:d,glow:l,pause:y,sound:m,voice:u,backgroundcolor:g,screenshake:w,nowait:function(t,e){t.startParsingAsync(e[0])}};async function h(t,e){let s=e[0],i=e[1];t.getProps().typeWriterProps.characterInitial.color="#FFFFFF",t.getProps().typeWriterProps.characterAnimate.color=s,t.getProps().typeWriterProps.blockStyle.color=s,t.getProps().typeWriterProps.characterTransition.color={duration:1.5,ease:"easeIn"},await t.startParsingAsync(i)}async function l(t,e){let s=e[0];t.getProps().typeWriterProps.characterInitial.textShadow="0em 0em 0em",t.getProps().typeWriterProps.characterAnimate.textShadow="0em 0em 0.5em",t.getProps().typeWriterProps.blockStyle.textShadow="0em 0em 0.5em",await t.startParsingAsync(s)}async function p(t,e){let s=parseInt(e[0]),i=e[1];t.getProps().typeWriterProps.typeSpeed=s,await t.startParsingAsync(i)}async function d(t,e){let s=e[0],i=e[1];t.getProps().typeWriterProps.blockStyle.fontSize=s,await t.startParsingAsync(i)}async function u(t,e){let s=parseInt(e[0]),i=parseInt(e[1]),r=e[2];t.getProps().typeWriterProps.pitch=s,t.getProps().typeWriterProps.gain=i/100,await t.startParsingAsync(r)}async function y(t,e){let s=parseInt(e[0]);await o(s)}async function m(t,e){let s=e[0],i=parseInt(e[1]),r=new Audio(s);if(r.volume=i/100,r.play(),3==e.length){let s=new Promise(t=>r.onended=()=>t());await t.startParsingAsync(e[2]),await s}}async function g(t,e){let s=parseInt(e[1]),i=e[0];document.body.style.transition="background-color ".concat(s,"ms"),document.body.style.backgroundColor=i,await o(s)}async function w(t,e){let s=parseInt(e[0]),i=parseInt(e[1]),r=parseInt(e[2]),a=document.body,n=a.style.transform;for(let t=0;t<i;t++){let t=Math.random()*s-s/2,e=Math.random()*s-s/2;a.style.transform="translate(".concat(t,"px, ").concat(e,"px)"),await o(r)}a.style.transform=n}class f extends r.Component{render(){return(0,i.jsx)("div",{className:"m-8",children:this.state.writers})}getProps(){return this.propsStack[this.propsStack.length-1]}async addTypewriterAsync(t,e){if(!t)return;let s=!0,r=(0,i.jsx)(n,{...e,text:t,onFinished:async()=>s=!1},this.state.writers.length);for(this.state.writers.push(r),this.setState(t=>({writers:[...t.writers]}));s;)await o(10)}async addDefaultTypewriterAsync(t){return this.addTypewriterAsync(t,this.getProps().typeWriterProps)}async startParsingAsync(t){t=this.replaceMacros(this.extractMacros(t)),1==this.propsStack.length&&null!=this.story&&(t=this.story.markNodesInText(t));let e="",s=0;for(let i of t)if("["==i&&(0==s&&e&&(await this.addDefaultTypewriterAsync(e),e=""),s++),e+=i,"]"==i){if(--s<0)throw Error("Mismatched brackets < 0");0==s&&(await this.handleCommandAsync(e),e="")}if(0!=s)throw Error("Mismatched brackets > 0");await this.addDefaultTypewriterAsync(e)}extractMacros(t){let e=/\$(\w+)\s*=\s*(.+)$/gm;for(let s of t.matchAll(e))this.macros.set(s[1],s[2]);return t=t.replaceAll(e,"[DELETE]").replaceAll(/\[DELETE\](?:\r\n|\r|\n)/g,"")}replaceMacros(t){for(let[e,s]of this.macros)t=t.replaceAll("${".concat(e,"}"),s);return t}async handleCommandAsync(t){let e=t.slice(1,-1),s=[],i="",r=0;for(let t of e)"["==t?r++:"]"==t&&r--,";"==t&&0==r?(s.push(i),i=""):i+=t;if((i||e.endsWith(";"))&&s.push(i),s[0]in c){this.startNesting();try{let t=c[s[0]](this,s.slice(1));t instanceof Promise&&await t}finally{this.endNesting()}}else throw Error("Unknown command: ".concat(s[0]))}startNesting(){let t=JSON.parse(JSON.stringify(this.getProps()));this.propsStack.push(t)}endNesting(){if(this.propsStack.pop(),0==this.propsStack.length)throw Error("Ended nesting more often than starting it.")}constructor(t){super(t),this.propsStack=[],this.macros=new Map,this.story=null,this.state={writers:[]},this.propsStack.push(t)}}class x{equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}getDistance(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)+Math.pow(this.z-t.z,2))}normalize(){let t=this.magnitude();return 0===t?new x(0,0,0):new x(this.x/t,this.y/t,this.z/t)}crossProduct(t){return new x(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}dotProduct(t){return this.x*t.x+this.y*t.y+this.z*t.z}magnitude(){return this.dotProduct(this)}constructor(t,e,s){this.x=t,this.y=e,this.z=s}}class S{triggerAsync(t){return(0,this.owner[this.ownerCallbackName])(t)}matches(t){let e=this.actionString.toLowerCase().split(" "),s=[],i=[];for(let r=0;r<e.length;r++){let o=e[r].split("|"),a=!1;for(let e of o){for(let r=0;r<t.length;r++)if(t[r].startsWith(e)){s.push(r),i.push(e),a=!0;break}if(a)break}if(!a)return null}return i}constructor(t,e,s){this.actionString=t,this.owner=e,this.ownerCallbackName=s}}class A{addChild(t){this.connections.push(t)}removeChild(t){this.connections=this.connections.filter(e=>e!==t)}checkNode(t){let e=[this.description,...this.connections.map(t=>t.context)];return t.startParsingAsync(e.join(". "))}addCheckAction(){this.actions.push(new S("Inspect|Assess|Analyze|Probe|Scan|Investigate|Survey|Examine|Check|Explore|Look",this,this.checkNode.name))}removeAction(t){this.actions=this.actions.filter(e=>e!==t)}constructor(t,e,s,i){this.connections=[],this.actions=[],this.color="#FFFFFF",this.sounds=[],this.name=t,this.context=e,this.description=s,this.coordinates=i,this.addCheckAction()}}class P extends A{moveTowards(t){t.startParsingAsync(this.moveDescription)}addMoveToAction(){this.actions.push(new S("Walk|Jog|Run|Sprint|Dash|March|Stroll|Saunter|Amble|Trek|Hike|Wander|Strut|Mosey|Glide|Shuffle|Tiptoe|Creep|Scurry|Scuttle|Rush|Charge|Bolt|Gallop|Bound|Lumber|Trudge|Stride|Pace|Roam|Drift|Meander|Advance|Proceed|Migrate|Relocate|Travel|Sneak",this,this.checkNode.name))}constructor(t,e,s,i,r){super(t,e,s,r),this.coordinates=r,this.color="#AAAAFF",this.moveDescription=i,this.addMoveToAction()}}class k extends x{setFacingDirection(t){this.facingDirection=t.normalize();let e=new x(0,1,0).crossProduct(this.facingDirection).normalize();e=e.normalize();let s=this.facingDirection.crossProduct(e).normalize();this.basisCoordinateSystem[0]=this.facingDirection,this.basisCoordinateSystem[1]=e,this.basisCoordinateSystem[2]=s}getDirection(t){let e=t.x-this.x,s=t.y-this.y,i=t.z-this.z,r=this.basisCoordinateSystem[1].x*e+this.basisCoordinateSystem[1].y*s+this.basisCoordinateSystem[1].z*i;return new x(r,this.basisCoordinateSystem[2].x*e+this.basisCoordinateSystem[2].y*s+this.basisCoordinateSystem[2].z*i,this.basisCoordinateSystem[0].x*e+this.basisCoordinateSystem[0].y*s+this.basisCoordinateSystem[0].z*i).normalize()}getDirectionExpression(t){let e=[],s=t.x,i=t.z;return s>0?e.push("to the right"):s<0&&e.push("to the left"),i>0?e.push("front"):i<0&&e.push("behind"),t.y>0?e.push("above"):t.y<0&&e.push("below"),e.join(", ")}constructor(t,e,s){super(t,e,s),this.x=t,this.y=e,this.z=s,this.basisCoordinateSystem=[new x(0,0,1),new x(1,0,0),new x(0,1,0)],this.setFacingDirection(new x(0,0,1))}}class C extends A{markNodesInText(t){for(let e of[this,this.player.location,...this.player.location.connections])t=t.replace(RegExp("(".concat(e.name.toLowerCase(),")"),"g"),"[color;".concat(e.color,";$1]"));return t}constructor(t,e,s,i){super(t,e,s,new x(0,0,0)),this.color="#FFFFAA",this.player=i}}let b=new(s(9087)).EventEmitter;class v{getCoordinates(){return this.coordinates}modifyCoordinates(t){t(this.coordinates),b.emit("playerMoved",this.coordinates)}constructor(t,e,s){this.name=t,this.location=e,this.coordinates=s}}class z extends C{constructor(){super("Demo","A short demo.","This is a [color;orange;demo] story. Please take your time getting adjusted to the way these games play.",new v("Hans",new P("Room","You see a dark room.","You see a dark room. Horrible screams can be heard from inside.","You walk into the room.",new x(0,0,0)),new k(0,0,0)))}}function T(){let t=(0,r.useRef)(null),e=new z;async function s(){var s,i;t.current.story=e,await e.checkNode(t.current),await e.player.location.checkNode(t.current),await e.player.location.moveTowards(t.current);let r=await fetch("/parserShowcase.txt").then(t=>t.text());await (null===(s=t.current)||void 0===s?void 0:s.startParsingAsync("\n\n")),await (null===(i=t.current)||void 0===i?void 0:i.startParsingAsync(r))}return(0,i.jsxs)("div",{children:[(0,i.jsx)("button",{onClick:s,children:"Start"}),(0,i.jsx)(f,{ref:t,typeWriterProps:{blockStyle:{fontSize:"24px",color:"#FFFFFF"},characterStyle:{},characterAnimate:{},characterInitial:{},characterTransition:{},pitch:0,gain:1,opacityAnimationDuration:200,typeSpeed:50,text:""}})]})}},8099:(t,e,s)=>{Promise.resolve().then(s.bind(s,2689))}},t=>{var e=e=>t(t.s=e);t.O(0,[424,441,684,358],()=>e(8099)),_N_E=t.O()}]);