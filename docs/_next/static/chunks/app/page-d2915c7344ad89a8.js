(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{787:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>P});var i=s(5155),r=s(2115);async function n(t){await new Promise(e=>setTimeout(e,t))}var a=s(226);class o extends r.Component{async typeAsync(t){var e,s,i,r,a,o,c;for(let e of t){this.state.animating.push(e),this.setState(t=>({animating:[...t.animating]})),this.makeStatic();let t=[".","!","?"].includes(e),l=[",",";",":"].includes(e),h=this.props.typeSpeed;if(t&&(h=25*this.props.typeSpeed),l&&(h=10*this.props.typeSpeed),this.props.pitch>0){let t=e.toLowerCase();if(/[a-z0-9]/.test(t)){let n=1+(t.charCodeAt(0)%10+1)/10/5;/[aeiou]/.test(e)?null===(i=this.oscillator)||void 0===i||i.frequency.setValueAtTime(1.2*this.props.pitch*n,(null===(s=this.audioCtx)||void 0===s?void 0:s.currentTime)||0):null===(a=this.oscillator)||void 0===a||a.frequency.setValueAtTime(this.props.pitch*n,(null===(r=this.audioCtx)||void 0===r?void 0:r.currentTime)||0)}else" "!=e&&(null===(c=this.oscillator)||void 0===c||c.frequency.setValueAtTime(0,(null===(o=this.audioCtx)||void 0===o?void 0:o.currentTime)||0))}await n(h)}this.props.pitch>0&&(this.oscillator.stop(),this.audioCtx.close()),null===(e=this.props.onFinished)||void 0===e||e.call(this)}async makeStatic(){await n(this.props.characterAnimationDuration);let t=this.state.animating.shift();this.setState(e=>({animating:[...e.animating],text:e.text+t}))}render(){let t=this.props.characterAnimationDuration/1e3;return(0,i.jsxs)("span",{style:{color:this.props.color,fontSize:this.props.size,whiteSpace:"pre-wrap"},children:[(0,i.jsx)(a.P.span,{children:this.state.text},"static-text"),this.state.animating.map((e,s)=>(0,i.jsx)(a.P.div,{style:{display:"inline-block"},initial:{opacity:0},animate:{opacity:1},transition:{duration:t,ease:"easeOut"},children:e},this.state.text.length+s))]},"typewriter-span")}constructor(t){if(super(t),this.oscillator=null,this.audioCtx=null,this.isRunning=!1,this.state={animating:[],text:""},this.props.pitch>0){this.audioCtx=new window.AudioContext;let t=this.audioCtx.createGain();t.gain.value=this.props.gain/3,t.connect(this.audioCtx.destination),this.oscillator=this.audioCtx.createOscillator(),this.oscillator.type="triangle",this.oscillator.connect(t),this.oscillator.frequency.setValueAtTime(0,this.audioCtx.currentTime),this.oscillator.start()}this.isRunning||(this.isRunning=!0,this.typeAsync(this.props.text))}}let c={color:l,speed:h,size:p,pause:d,sound:y,voice:u,backgroundcolor:m,screenshake:f,nowait:function(t,e){t.startParsingAsync(e[0])}};async function l(t,e){let s=e[0],i=e[1];t.getProps().typeWriterProps.color=s,await t.startParsingAsync(i)}async function h(t,e){let s=parseInt(e[0]),i=e[1];t.getProps().typeWriterProps.typeSpeed=s,await t.startParsingAsync(i)}async function p(t,e){let s=e[0],i=e[1];t.getProps().typeWriterProps.size=s,await t.startParsingAsync(i)}async function u(t,e){let s=parseInt(e[0]),i=parseInt(e[1]),r=e[2];t.getProps().typeWriterProps.pitch=s,t.getProps().typeWriterProps.gain=i/100,await t.startParsingAsync(r)}async function d(t,e){let s=parseInt(e[0]);await n(s)}async function y(t,e){let s=e[0],i=parseInt(e[1]),r=new Audio(s);if(r.volume=i/100,r.play(),3==e.length){let s=new Promise(t=>r.onended=()=>t());await t.startParsingAsync(e[2]),await s}}async function m(t,e){let s=parseInt(e[1]),i=e[0];document.body.style.transition="background-color ".concat(s,"ms"),document.body.style.backgroundColor=i,await n(s)}async function f(t,e){let s=parseInt(e[0]),i=parseInt(e[1]),r=parseInt(e[2]),a=document.body,o=a.style.transform;for(let t=0;t<i;t++){let t=Math.random()*s-s/2,e=Math.random()*s-s/2;a.style.transform="translate(".concat(t,"px, ").concat(e,"px)"),await n(r)}a.style.transform=o}class g extends r.Component{render(){return(0,i.jsx)("div",{className:"m-8",children:this.state.writers})}getProps(){return this.propsStack[this.propsStack.length-1]}async addTypewriterAsync(t,e){if(!t)return;let s=!0,r=(0,i.jsx)(o,{...e,text:t,onFinished:async()=>s=!1},this.state.writers.length);for(this.state.writers.push(r),this.setState(t=>({writers:[...t.writers]}));s;)await n(10)}async addDefaultTypewriterAsync(t){return this.addTypewriterAsync(t,this.getProps().typeWriterProps)}async startParsingAsync(t){t=this.replaceMacros(this.extractMacros(t)),1==this.propsStack.length&&null!=this.story&&(t=this.story.markNodesInText(t));let e="",s=0;for(let i of t)if("["==i&&(0==s&&e&&(await this.addDefaultTypewriterAsync(e),e=""),s++),e+=i,"]"==i){if(--s<0)throw Error("Mismatched brackets < 0");0==s&&(await this.handleCommandAsync(e),e="")}if(0!=s)throw Error("Mismatched brackets > 0");await this.addDefaultTypewriterAsync(e)}extractMacros(t){let e=/\$(\w+)\s*=\s*(.+)$/gm;for(let s of t.matchAll(e))this.macros.set(s[1],s[2]);return t=t.replaceAll(e,"[DELETE]").replaceAll(/\[DELETE\](?:\r\n|\r|\n)/g,"")}replaceMacros(t){for(let[e,s]of this.macros)t=t.replaceAll("${".concat(e,"}"),s);return t}async handleCommandAsync(t){let e=t.slice(1,-1),s=[],i="",r=0;for(let t of e)"["==t?r++:"]"==t&&r--,";"==t&&0==r?(s.push(i),i=""):i+=t;if((i||e.endsWith(";"))&&s.push(i),s[0]in c){this.startNesting();try{let t=c[s[0]](this,s.slice(1));t instanceof Promise&&await t}finally{this.endNesting()}}else throw Error("Unknown command: ".concat(s[0]))}startNesting(){let t=JSON.parse(JSON.stringify(this.getProps()));this.propsStack.push(t)}endNesting(){if(this.propsStack.pop(),0==this.propsStack.length)throw Error("Ended nesting more often than starting it.")}constructor(t){super(t),this.propsStack=[],this.macros=new Map,this.story=null,this.state={writers:[]},this.propsStack.push(t)}}class w{triggerAsync(t){return(0,this.owner[this.ownerCallbackName])(t)}matches(t){let e=this.actionString.toLowerCase().split(" "),s=[],i=[];for(let r=0;r<e.length;r++){let n=e[r].split("|"),a=!1;for(let e of n){for(let r=0;r<t.length;r++)if(t[r].startsWith(e)){s.push(r),i.push(e),a=!0;break}if(a)break}if(!a)return null}return i}constructor(t,e,s){this.actionString=t,this.owner=e,this.ownerCallbackName=s}}class A{addChild(t){this.connections.push(t)}removeChild(t){this.connections=this.connections.filter(e=>e!==t)}checkNode(t){let e=[this.description,...this.connections.map(t=>t.context)];return t.startParsingAsync(e.join(". "))}addCheckAction(){this.actions.push(new w("Inspect|Assess|Analyze|Probe|Scan|Investigate|Survey|Examine|Check|Explore|Look",this,this.checkNode.name))}removeAction(t){this.actions=this.actions.filter(e=>e!==t)}constructor(t,e,s){this.connections=[],this.actions=[],this.color="#FFFFFF",this.name=t,this.context=e,this.description=s,this.addCheckAction()}}class x extends A{moveTowards(t){t.startParsingAsync(this.moveDescription)}addMoveToAction(){this.actions.push(new w("Walk|Jog|Run|Sprint|Dash|March|Stroll|Saunter|Amble|Trek|Hike|Wander|Strut|Mosey|Glide|Shuffle|Tiptoe|Creep|Scurry|Scuttle|Rush|Charge|Bolt|Gallop|Bound|Lumber|Trudge|Stride|Pace|Roam|Drift|Meander|Advance|Proceed|Migrate|Relocate|Travel|Sneak",this,this.checkNode.name))}constructor(t,e,s,i){super(t,e,s),this.color="#AAAAFF",this.moveDescription=i,this.addMoveToAction()}}class k extends A{markNodesInText(t){for(let e of[this,this.player.location,...this.player.location.connections])t=t.replace(RegExp("(".concat(e.name.toLowerCase(),")"),"g"),"[color;".concat(e.color,";$1]"));return t}constructor(t,e,s,i){super(t,e,s),this.color="#FFFFAA",this.player=i}}class v{constructor(t,e){this.name=t,this.location=e}}class S extends k{constructor(){super("Demo","A short demo.","This is a [color;orange;demo] story. Please take your time getting adjusted to the way these games play.",new v("Hans",new x("Room","You see a dark room.","You see a dark room. Horrible screams can be heard from inside.","You walk into the room.")))}}function P(){let t=(0,r.useRef)(null),e=new S;async function s(){var s,i;t.current.story=e,await e.checkNode(t.current);let r=await fetch("/parserShowcase.txt").then(t=>t.text());await (null===(s=t.current)||void 0===s?void 0:s.startParsingAsync("\n\n")),await (null===(i=t.current)||void 0===i?void 0:i.startParsingAsync(r))}return(0,i.jsxs)("div",{children:[(0,i.jsx)("button",{onClick:s,children:"Start"}),(0,i.jsx)(g,{ref:t,typeWriterProps:{pitch:0,gain:1,characterAnimationDuration:300,typeSpeed:50,color:"white",size:"24px",text:""}})]})}},8323:(t,e,s)=>{Promise.resolve().then(s.bind(s,787))}},t=>{var e=e=>t(t.s=e);t.O(0,[226,441,684,358],()=>e(8323)),_N_E=t.O()}]);