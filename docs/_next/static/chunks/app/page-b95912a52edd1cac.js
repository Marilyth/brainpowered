(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{5601:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>G});var i=s(5155),r=s(2115),a=s(351),n=s(226);let o=(0,s(3438).PA)(t=>{let{viewModel:e}=t;async function s(){}return(0,i.jsx)("div",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:e.renderedTextBlocks.map((t,e)=>(0,i.jsx)("span",{style:{display:"inline",...t[0].characterStyle},children:t[1].map((r,a)=>(0,i.jsx)(n.P.span,{onAnimationEnd:s,initial:{opacity:0,...t[0].characterInitial},animate:{opacity:1,...t[0].characterAnimate},transition:{duration:t[0].opacityAnimationDuration,ease:"easeOut",...t[0].characterTransition},style:{display:"inline"},children:r},"".concat(e,"-").concat(a,"-").concat(r)))},e))},"typewriter-span")});class c{equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}getDistance(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)+Math.pow(this.z-t.z,2))}normalize(){let t=this.magnitude();return 0===t?new c(0,0,0):new c(this.x/t,this.y/t,this.z/t)}crossProduct(t){return new c(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}dotProduct(t){return this.x*t.x+this.y*t.y+this.z*t.z}magnitude(){return this.dotProduct(this)}constructor(t,e,s){this.x=t,this.y=e,this.z=s}}class l{triggerAsync(t){return(0,this.owner[this.ownerCallbackName])(t)}matches(t){let e=this.actionString.toLowerCase().split(" "),s=[],i=[];for(let r=0;r<e.length;r++){let a=e[r].split("|"),n=!1;for(let e of a){for(let r=0;r<t.length;r++)if(t[r].startsWith(e)){s.push(r),i.push(e),n=!0;break}if(n)break}if(!n)return null}return i}constructor(t,e,s){this.actionString=t,this.owner=e,this.ownerCallbackName=s}}class h{addChild(t){this.connections.push(t)}removeChild(t){this.connections=this.connections.filter(e=>e!==t)}checkNode(t){let e=[this.description,...this.connections.map(t=>t.context)];return t.startParsingAsync(e.join(". "))}addCheckAction(){this.actions.push(new l("Inspect|Assess|Analyze|Probe|Scan|Investigate|Survey|Examine|Check|Explore|Look",this,this.checkNode.name))}removeAction(t){this.actions=this.actions.filter(e=>e!==t)}constructor(t,e,s,i){this.connections=[],this.actions=[],this.color="#FFFFFF",this.sounds=[],this.name=t,this.context=e,this.description=s,this.coordinates=i,this.addCheckAction()}}class d extends h{moveTowards(t){return t.startParsingAsync(this.moveDescription)}addMoveToAction(){this.actions.push(new l("Walk|Jog|Run|Sprint|Dash|March|Stroll|Saunter|Amble|Trek|Hike|Wander|Strut|Mosey|Glide|Shuffle|Tiptoe|Creep|Scurry|Scuttle|Rush|Charge|Bolt|Gallop|Bound|Lumber|Trudge|Stride|Pace|Roam|Drift|Meander|Advance|Proceed|Migrate|Relocate|Travel|Sneak",this,this.checkNode.name))}constructor(t,e,s,i,r){super(t,e,s,r),this.coordinates=r,this.color="#AAAAFF",this.moveDescription=i,this.addMoveToAction()}}class u extends c{setFacingDirection(t){this.facingDirection=t.normalize();let e=new c(0,1,0).crossProduct(this.facingDirection).normalize();e=e.normalize();let s=this.facingDirection.crossProduct(e).normalize();this.basisCoordinateSystem[0]=this.facingDirection,this.basisCoordinateSystem[1]=e,this.basisCoordinateSystem[2]=s}getDirection(t){let e=t.x-this.x,s=t.y-this.y,i=t.z-this.z,r=this.basisCoordinateSystem[1].x*e+this.basisCoordinateSystem[1].y*s+this.basisCoordinateSystem[1].z*i;return new c(r,this.basisCoordinateSystem[2].x*e+this.basisCoordinateSystem[2].y*s+this.basisCoordinateSystem[2].z*i,this.basisCoordinateSystem[0].x*e+this.basisCoordinateSystem[0].y*s+this.basisCoordinateSystem[0].z*i).normalize()}getDirectionExpression(t){let e=[],s=t.x,i=t.z;return s>0?e.push("to the right"):s<0&&e.push("to the left"),i>0?e.push("front"):i<0&&e.push("behind"),t.y>0?e.push("above"):t.y<0&&e.push("below"),e.join(", ")}constructor(t,e,s){super(t,e,s),this.x=t,this.y=e,this.z=s,this.basisCoordinateSystem=[new c(0,0,1),new c(1,0,0),new c(0,1,0)],this.setFacingDirection(new c(0,0,1))}}class p extends h{markNodesInText(t){for(let e of[this,this.player.location,...this.player.location.connections])t=t.replace(RegExp("(".concat(e.name.toLowerCase(),")"),"g"),"[color;".concat(e.color,";$1]"));return t}constructor(t,e,s,i){super(t,e,s,new c(0,0,0)),this.color="#FFFFAA",this.player=i}}let g=new(s(9087)).EventEmitter;class m{getCoordinates(){return this.coordinates}modifyCoordinates(t){t(this.coordinates),g.emit("playerMoved",this.coordinates)}constructor(t,e,s){this.name=t,this.location=e,this.coordinates=s}}class y extends p{constructor(){super("Demo","A short demo.","This is a [color;orange;demo] story. Please take your time getting adjusted to the way these games play.",new m("Hans",new d("Room","You see a dark room.","You see a dark room. Horrible screams can be heard from inside.","You walk into the room.",new c(0,0,0)),new u(0,0,0)))}}async function f(t){await new Promise(e=>setTimeout(e,t))}let x={color:v,speed:b,size:k,glow:w,pause:C,sound:S,voice:A,backgroundcolor:P,screenshake:N,nowait:function(t,e){t.startParsingAsync(e[0])}};async function v(t,e){let s=e[0],i=e[1];t.getProps().characterInitial.color="#FFFFFF",t.getProps().characterAnimate.color=s,t.getProps().characterTransition.color={duration:.3,ease:"easeIn"},await t.startParsingAsync(i)}async function w(t,e){let s=e[0];t.getProps().characterInitial.textShadow="0em 0em 0em",t.getProps().characterAnimate.textShadow="0em 0em 0.5em",console.log("glowing: "+s),await t.startParsingAsync(s)}async function b(t,e){let s=parseInt(e[0]),i=e[1];t.getProps().typeSpeed=s,await t.startParsingAsync(i)}async function k(t,e){let s=e[0],i=e[1];t.getProps().characterStyle.fontSize=s,await t.startParsingAsync(i)}async function A(t,e){let s=parseInt(e[0]),i=parseInt(e[1]),r=e[2];t.getProps().pitch=s,t.getProps().gain=i/100,await t.startParsingAsync(r)}async function C(t,e){let s=parseInt(e[0]);await f(s)}async function S(t,e){let s=e[0],i=parseInt(e[1]),r=new Audio(s);if(r.volume=i/100,r.play(),3==e.length){let s=new Promise(t=>r.onended=()=>t());await t.startParsingAsync(e[2]),await s}}async function P(t,e){let s=parseInt(e[1]),i=e[0];document.body.style.transition="background-color ".concat(s,"ms"),document.body.style.backgroundColor=i,await f(s)}async function N(t,e){let s=parseInt(e[0]),i=parseInt(e[1]),r=parseInt(e[2]),a=document.body,n=a.style.transform;for(let t=0;t<i;t++){let t=Math.random()*s-s/2,e=Math.random()*s-s/2;a.style.transform="translate(".concat(t,"px, ").concat(e,"px)"),await f(r)}a.style.transform=n}var z=s(9543);class T{setAudioContext(){this.audioCtx=new window.AudioContext,this.gainNode=this.audioCtx.createGain(),this.gainNode.gain.value=0,this.gainNode.connect(this.audioCtx.destination),this.oscillator=this.audioCtx.createOscillator(),this.oscillator.type="triangle",this.oscillator.connect(this.gainNode),this.oscillator.frequency.setValueAtTime(0,this.audioCtx.currentTime),this.oscillator.start()}getProps(){return this.propsStack[this.propsStack.length-1]}async startParsingAsync(t){t=this.replaceMacros(this.extractMacros(t)),1!=this.propsStack.length||(this.isBusy=!0,null!=this.story&&(t=this.story.markNodesInText(t)),!this.lastCharacter||/^\s/.test(t)||/\s$/.test(this.lastCharacter)||(t=" "+t));let e="",s=0;for(let i of t)if("["==i&&(0==s&&e&&(await this.typeAsync(e),e=""),s++),e+=i,"]"==i){if(--s<0)throw Error("Mismatched brackets < 0");0==s&&(await this.handleCommandAsync(e),e="")}if(0!=s)throw Error("Mismatched brackets > 0");await this.typeAsync(e),1==this.propsStack.length&&(this.isBusy=!1)}extractMacros(t){let e=/\$(\w+)\s*=\s*(.+)$/gm;for(let s of t.matchAll(e))this.macros.set(s[1],s[2]);return t=t.replaceAll(e,"[DELETE]").replaceAll(/\[DELETE\](?:\r\n|\r|\n)/g,"")}async typeAsync(t){var e,s,i,r,a,n,o,c,l,h,d,u;null===(s=this.gainNode)||void 0===s||s.gain.setValueAtTime(this.getProps().gain,(null===(e=this.audioCtx)||void 0===e?void 0:e.currentTime)||0);let p=this.renderedTextBlocks.push([this.getProps(),[]])-1;for(let e of t){this.renderedTextBlocks[p][1].push(e),this.lastCharacter=e;let t=[".","!","?"].includes(e),s=[",",";",":"].includes(e),l=this.getProps().typeSpeed;if(t&&(l=25*this.getProps().typeSpeed),s&&(l=10*this.getProps().typeSpeed),this.getProps().pitch>0){let t=e.toLowerCase();if(/[a-z0-9]/.test(t)){let s=1+(t.charCodeAt(0)%10+1)/10/5;/[aeiou]/.test(e)?null===(r=this.oscillator)||void 0===r||r.frequency.setValueAtTime(1.2*this.getProps().pitch*s,(null===(i=this.audioCtx)||void 0===i?void 0:i.currentTime)||0):null===(n=this.oscillator)||void 0===n||n.frequency.setValueAtTime(this.getProps().pitch*s,(null===(a=this.audioCtx)||void 0===a?void 0:a.currentTime)||0)}else" "!=e&&(null===(c=this.oscillator)||void 0===c||c.frequency.setValueAtTime(0,(null===(o=this.audioCtx)||void 0===o?void 0:o.currentTime)||0))}await f(l)}this.getProps().pitch>0&&(null===(h=this.oscillator)||void 0===h||h.frequency.setValueAtTime(0,(null===(l=this.audioCtx)||void 0===l?void 0:l.currentTime)||0),null===(u=this.gainNode)||void 0===u||u.gain.setValueAtTime(0,(null===(d=this.audioCtx)||void 0===d?void 0:d.currentTime)||0))}replaceMacros(t){for(let[e,s]of this.macros)t=t.replaceAll("${".concat(e,"}"),s);return t}async handleCommandAsync(t){console.log(t);let e=t.slice(1,-1),s=[],i="",r=0;for(let t of e)"["==t?r++:"]"==t&&r--,";"==t&&0==r?(s.push(i),i=""):i+=t;if((i||e.endsWith(";"))&&s.push(i),s[0]in x){this.startNesting();try{let t=x[s[0]](this,s.slice(1));t instanceof Promise&&await t}finally{this.endNesting()}}else throw Error("Unknown command: ".concat(s[0]))}startNesting(){let t=JSON.parse(JSON.stringify(this.getProps()));this.propsStack.push(t)}endNesting(){if(this.propsStack.pop(),0==this.propsStack.length)throw Error("Ended nesting more often than starting it.")}constructor(t){this.story=null,this.renderedTextBlocks=[],this.isBusy=!1,this.propsStack=[],this.macros=new Map,this.oscillator=null,this.audioCtx=null,this.gainNode=null,this.lastCharacter="",(0,z.l_)(this),this.propsStack.push(t)}}var j=s(2596),F=s(9688);function E(){for(var t=arguments.length,e=Array(t),s=0;s<t;s++)e[s]=arguments[s];return(0,F.QP)((0,j.$)(e))}function D(t){let{className:e,...s}=t;return(0,i.jsx)("div",{"data-slot":"card",className:E("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...s})}function M(t){let{className:e,...s}=t;return(0,i.jsx)("div",{"data-slot":"card-header",className:E("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-[data-slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...s})}function I(t){let{className:e,...s}=t;return(0,i.jsx)("div",{"data-slot":"card-title",className:E("leading-none font-semibold",e),...s})}function _(t){let{className:e,...s}=t;return(0,i.jsx)("div",{"data-slot":"card-content",className:E("px-6",e),...s})}function B(t){let{className:e,type:s,...r}=t;return(0,i.jsx)("input",{type:s,"data-slot":"input",className:E("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",e),...r})}var R=s(4624);let V=(0,s(2085).F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function q(t){let{className:e,variant:s,size:r,asChild:a=!1,...n}=t,o=a?R.DX:"button";return(0,i.jsx)(o,{"data-slot":"button",className:E(V({variant:s,size:r,className:e})),...n})}var L=s(1174);function O(t){let{className:e,orientation:s="horizontal",decorative:r=!0,...a}=t;return(0,i.jsx)(L.b,{"data-slot":"separator-root",decorative:r,orientation:s,className:E("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",e),...a})}function $(){let[t,e]=(0,r.useState)(""),s=(0,r.useRef)(null),n=(0,r.useRef)(!1),c=(0,r.useRef)(new y),l=(0,r.useRef)(new T({opacityAnimationDuration:.3,typeSpeed:50,pitch:0,gain:1,characterStyle:{fontSize:"20px",color:"#FFFFFF"},characterInitial:{},characterAnimate:{},characterTransition:{}}));async function h(){if(e(""),"start"==t){l.current.setAudioContext(),console.log("Starting the story..."),l.current.story=c.current,await c.current.checkNode(l.current),await c.current.player.location.checkNode(l.current),await c.current.player.location.moveTowards(l.current);let t=await fetch("/parserShowcase.txt").then(t=>t.text());await l.current.startParsingAsync("\n\n"),await l.current.startParsingAsync(t)}s.current.focus()}return(0,r.useEffect)(()=>{n.current||(n.current=!0,l.current.startParsingAsync("Enter [color;orange;start] to start the story."),s.current.focus())},[l]),(0,i.jsxs)("div",{className:"grid grid-rows-[1fr_auto] gap-4 p-8 h-full w-full",children:[(0,i.jsxs)(D,{className:"bg-[#ffffff10]",children:[(0,i.jsxs)(M,{className:"flex flex-col items-center text-center",children:[(0,i.jsx)(I,{className:"pb-2",children:"Demo story"}),(0,i.jsx)(O,{})]}),(0,i.jsx)(_,{className:"h-0 flex-grow overflow-auto",children:(0,i.jsx)(o,{viewModel:l.current})})]}),(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)(B,{className:"pr-12",ref:s,type:"text",value:t,onChange:t=>e(t.target.value),placeholder:"What do you do?",onKeyDown:t=>{"Enter"===t.key&&h()}}),(0,i.jsx)(q,{onClick:h,className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-0 bg-transparent text-gray-500 hover:bg-transparent",children:(0,i.jsx)(a.kGk,{})})]})]})}var W=s(1362);function G(){let{setTheme:t}=(0,W.useTheme)();return t("dark"),(0,i.jsx)("div",{className:"w-screen h-screen",children:(0,i.jsx)($,{})})}},8323:(t,e,s)=>{Promise.resolve().then(s.bind(s,5601))}},t=>{var e=e=>t(t.s=e);t.O(0,[844,866,292,441,684,358],()=>e(8323)),_N_E=t.O()}]);