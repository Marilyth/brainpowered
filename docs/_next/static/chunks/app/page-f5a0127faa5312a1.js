(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3237:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>z});var i=s(5155);s(2115);var o=s(226);let n=(0,s(3438).PA)(t=>{let{viewModel:e}=t;async function s(){}return(0,i.jsx)("div",{className:"m-8",style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:e.renderedTextBlocks.map((t,e)=>(0,i.jsx)("span",{style:{display:"inline",...t[0].characterStyle},children:t[1].map((n,a)=>(0,i.jsx)(o.P.span,{onAnimationEnd:s,initial:{opacity:0,...t[0].characterInitial},animate:{opacity:1,...t[0].characterAnimate},transition:{duration:t[0].opacityAnimationDuration,ease:"easeOut",...t[0].characterTransition},style:{display:"inline"},children:n},"".concat(e,"-").concat(a,"-").concat(n)))},e))},"typewriter-span")});class a{equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}getDistance(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)+Math.pow(this.z-t.z,2))}normalize(){let t=this.magnitude();return 0===t?new a(0,0,0):new a(this.x/t,this.y/t,this.z/t)}crossProduct(t){return new a(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}dotProduct(t){return this.x*t.x+this.y*t.y+this.z*t.z}magnitude(){return this.dotProduct(this)}constructor(t,e,s){this.x=t,this.y=e,this.z=s}}class r{triggerAsync(t){return(0,this.owner[this.ownerCallbackName])(t)}matches(t){let e=this.actionString.toLowerCase().split(" "),s=[],i=[];for(let o=0;o<e.length;o++){let n=e[o].split("|"),a=!1;for(let e of n){for(let o=0;o<t.length;o++)if(t[o].startsWith(e)){s.push(o),i.push(e),a=!0;break}if(a)break}if(!a)return null}return i}constructor(t,e,s){this.actionString=t,this.owner=e,this.ownerCallbackName=s}}class c{addChild(t){this.connections.push(t)}removeChild(t){this.connections=this.connections.filter(e=>e!==t)}checkNode(t){let e=[this.description,...this.connections.map(t=>t.context)];return t.startParsingAsync(e.join(". "))}addCheckAction(){this.actions.push(new r("Inspect|Assess|Analyze|Probe|Scan|Investigate|Survey|Examine|Check|Explore|Look",this,this.checkNode.name))}removeAction(t){this.actions=this.actions.filter(e=>e!==t)}constructor(t,e,s,i){this.connections=[],this.actions=[],this.color="#FFFFFF",this.sounds=[],this.name=t,this.context=e,this.description=s,this.coordinates=i,this.addCheckAction()}}class h extends c{moveTowards(t){return t.startParsingAsync(this.moveDescription)}addMoveToAction(){this.actions.push(new r("Walk|Jog|Run|Sprint|Dash|March|Stroll|Saunter|Amble|Trek|Hike|Wander|Strut|Mosey|Glide|Shuffle|Tiptoe|Creep|Scurry|Scuttle|Rush|Charge|Bolt|Gallop|Bound|Lumber|Trudge|Stride|Pace|Roam|Drift|Meander|Advance|Proceed|Migrate|Relocate|Travel|Sneak",this,this.checkNode.name))}constructor(t,e,s,i,o){super(t,e,s,o),this.coordinates=o,this.color="#AAAAFF",this.moveDescription=i,this.addMoveToAction()}}class l extends a{setFacingDirection(t){this.facingDirection=t.normalize();let e=new a(0,1,0).crossProduct(this.facingDirection).normalize();e=e.normalize();let s=this.facingDirection.crossProduct(e).normalize();this.basisCoordinateSystem[0]=this.facingDirection,this.basisCoordinateSystem[1]=e,this.basisCoordinateSystem[2]=s}getDirection(t){let e=t.x-this.x,s=t.y-this.y,i=t.z-this.z,o=this.basisCoordinateSystem[1].x*e+this.basisCoordinateSystem[1].y*s+this.basisCoordinateSystem[1].z*i;return new a(o,this.basisCoordinateSystem[2].x*e+this.basisCoordinateSystem[2].y*s+this.basisCoordinateSystem[2].z*i,this.basisCoordinateSystem[0].x*e+this.basisCoordinateSystem[0].y*s+this.basisCoordinateSystem[0].z*i).normalize()}getDirectionExpression(t){let e=[],s=t.x,i=t.z;return s>0?e.push("to the right"):s<0&&e.push("to the left"),i>0?e.push("front"):i<0&&e.push("behind"),t.y>0?e.push("above"):t.y<0&&e.push("below"),e.join(", ")}constructor(t,e,s){super(t,e,s),this.x=t,this.y=e,this.z=s,this.basisCoordinateSystem=[new a(0,0,1),new a(1,0,0),new a(0,1,0)],this.setFacingDirection(new a(0,0,1))}}class d extends c{markNodesInText(t){for(let e of[this,this.player.location,...this.player.location.connections])t=t.replace(RegExp("(".concat(e.name.toLowerCase(),")"),"g"),"[color;".concat(e.color,";$1]"));return t}constructor(t,e,s,i){super(t,e,s,new a(0,0,0)),this.color="#FFFFAA",this.player=i}}let u=new(s(9087)).EventEmitter;class p{getCoordinates(){return this.coordinates}modifyCoordinates(t){t(this.coordinates),u.emit("playerMoved",this.coordinates)}constructor(t,e,s){this.name=t,this.location=e,this.coordinates=s}}class y extends d{constructor(){super("Demo","A short demo.","This is a [color;orange;demo] story. Please take your time getting adjusted to the way these games play.",new p("Hans",new h("Room","You see a dark room.","You see a dark room. Horrible screams can be heard from inside.","You walk into the room.",new a(0,0,0)),new l(0,0,0)))}}async function m(t){await new Promise(e=>setTimeout(e,t))}let g={color:w,speed:x,size:A,glow:f,pause:k,sound:C,voice:S,backgroundcolor:P,screenshake:v,nowait:function(t,e){t.startParsingAsync(e[0])}};async function w(t,e){let s=e[0],i=e[1];t.getProps().characterInitial.color="#FFFFFF",t.getProps().characterAnimate.color=s,t.getProps().characterTransition.color={duration:.3,ease:"easeIn"},await t.startParsingAsync(i)}async function f(t,e){let s=e[0];t.getProps().characterInitial.textShadow="0em 0em 0em",t.getProps().characterAnimate.textShadow="0em 0em 0.5em",console.log("glowing: "+s),await t.startParsingAsync(s)}async function x(t,e){let s=parseInt(e[0]),i=e[1];t.getProps().typeSpeed=s,await t.startParsingAsync(i)}async function A(t,e){let s=e[0],i=e[1];t.getProps().characterStyle.fontSize=s,await t.startParsingAsync(i)}async function S(t,e){let s=parseInt(e[0]),i=parseInt(e[1]),o=e[2];t.getProps().pitch=s,t.getProps().gain=i/100,await t.startParsingAsync(o)}async function k(t,e){let s=parseInt(e[0]);await m(s)}async function C(t,e){let s=e[0],i=parseInt(e[1]),o=new Audio(s);if(o.volume=i/100,o.play(),3==e.length){let s=new Promise(t=>o.onended=()=>t());await t.startParsingAsync(e[2]),await s}}async function P(t,e){let s=parseInt(e[1]),i=e[0];document.body.style.transition="background-color ".concat(s,"ms"),document.body.style.backgroundColor=i,await m(s)}async function v(t,e){let s=parseInt(e[0]),i=parseInt(e[1]),o=parseInt(e[2]),n=document.body,a=n.style.transform;for(let t=0;t<i;t++){let t=Math.random()*s-s/2,e=Math.random()*s-s/2;n.style.transform="translate(".concat(t,"px, ").concat(e,"px)"),await m(o)}n.style.transform=a}var b=s(9543);class T{setAudioContext(){this.audioCtx=new window.AudioContext,this.gainNode=this.audioCtx.createGain(),this.gainNode.gain.value=0,this.gainNode.connect(this.audioCtx.destination),this.oscillator=this.audioCtx.createOscillator(),this.oscillator.type="triangle",this.oscillator.connect(this.gainNode),this.oscillator.frequency.setValueAtTime(0,this.audioCtx.currentTime),this.oscillator.start()}getProps(){return this.propsStack[this.propsStack.length-1]}async startParsingAsync(t){t=this.replaceMacros(this.extractMacros(t)),1==this.propsStack.length&&null!=this.story&&(t=this.story.markNodesInText(t));let e="",s=0;for(let i of t)if("["==i&&(0==s&&e&&(await this.typeAsync(e),e=""),s++),e+=i,"]"==i){if(--s<0)throw Error("Mismatched brackets < 0");0==s&&(await this.handleCommandAsync(e),e="")}if(0!=s)throw Error("Mismatched brackets > 0");await this.typeAsync(e)}extractMacros(t){let e=/\$(\w+)\s*=\s*(.+)$/gm;for(let s of t.matchAll(e))this.macros.set(s[1],s[2]);return t=t.replaceAll(e,"[DELETE]").replaceAll(/\[DELETE\](?:\r\n|\r|\n)/g,"")}async typeAsync(t){var e,s,i,o,n,a,r,c,h,l,d,u;null===(s=this.gainNode)||void 0===s||s.gain.setValueAtTime(this.getProps().gain,(null===(e=this.audioCtx)||void 0===e?void 0:e.currentTime)||0);let p=this.renderedTextBlocks.push([this.getProps(),[]])-1;for(let e of t){this.renderedTextBlocks[p][1].push(e);let t=[".","!","?"].includes(e),s=[",",";",":"].includes(e),h=this.getProps().typeSpeed;if(t&&(h=25*this.getProps().typeSpeed),s&&(h=10*this.getProps().typeSpeed),this.getProps().pitch>0){let t=e.toLowerCase();if(/[a-z0-9]/.test(t)){let s=1+(t.charCodeAt(0)%10+1)/10/5;/[aeiou]/.test(e)?null===(o=this.oscillator)||void 0===o||o.frequency.setValueAtTime(1.2*this.getProps().pitch*s,(null===(i=this.audioCtx)||void 0===i?void 0:i.currentTime)||0):null===(a=this.oscillator)||void 0===a||a.frequency.setValueAtTime(this.getProps().pitch*s,(null===(n=this.audioCtx)||void 0===n?void 0:n.currentTime)||0)}else" "!=e&&(null===(c=this.oscillator)||void 0===c||c.frequency.setValueAtTime(0,(null===(r=this.audioCtx)||void 0===r?void 0:r.currentTime)||0))}await m(h)}this.getProps().pitch>0&&(null===(l=this.oscillator)||void 0===l||l.frequency.setValueAtTime(0,(null===(h=this.audioCtx)||void 0===h?void 0:h.currentTime)||0),null===(u=this.gainNode)||void 0===u||u.gain.setValueAtTime(0,(null===(d=this.audioCtx)||void 0===d?void 0:d.currentTime)||0))}replaceMacros(t){for(let[e,s]of this.macros)t=t.replaceAll("${".concat(e,"}"),s);return t}async handleCommandAsync(t){console.log(t);let e=t.slice(1,-1),s=[],i="",o=0;for(let t of e)"["==t?o++:"]"==t&&o--,";"==t&&0==o?(s.push(i),i=""):i+=t;if((i||e.endsWith(";"))&&s.push(i),s[0]in g){this.startNesting();try{let t=g[s[0]](this,s.slice(1));t instanceof Promise&&await t}finally{this.endNesting()}}else throw Error("Unknown command: ".concat(s[0]))}startNesting(){let t=JSON.parse(JSON.stringify(this.getProps()));this.propsStack.push(t)}endNesting(){if(this.propsStack.pop(),0==this.propsStack.length)throw Error("Ended nesting more often than starting it.")}constructor(t){this.story=null,this.renderedTextBlocks=[],this.propsStack=[],this.macros=new Map,this.oscillator=null,this.audioCtx=null,this.gainNode=null,(0,b.l_)(this),this.propsStack.push(t)}}function z(){let t=new T({opacityAnimationDuration:.3,typeSpeed:50,pitch:0,gain:1,characterStyle:{fontSize:"20px",color:"#FFFFFF"},characterInitial:{},characterAnimate:{},characterTransition:{}}),e=new y;async function s(){t.setAudioContext(),t.story=e,await e.checkNode(t),await e.player.location.checkNode(t),await e.player.location.moveTowards(t);let s=await fetch("/parserShowcase.txt").then(t=>t.text());await t.startParsingAsync("\n\n"),await t.startParsingAsync(s)}return(0,i.jsxs)("div",{children:[(0,i.jsx)("button",{onClick:s,children:"Start"}),(0,i.jsx)(n,{viewModel:t})]})}},8099:(t,e,s)=>{Promise.resolve().then(s.bind(s,3237))}},t=>{var e=e=>t(t.s=e);t.O(0,[866,905,441,684,358],()=>e(8099)),_N_E=t.O()}]);